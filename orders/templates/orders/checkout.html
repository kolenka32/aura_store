{% extends 'products/base.html' %}

{% block head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
    * { font-family: 'Inter', sans-serif; }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <h1 class="text-3xl font-light text-gray-900 tracking-tight text-center mb-10">ФОРМА ЗАКАЗА</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 max-w-7xl mx-auto">
            <!-- Левая колонка - Форма -->
            <div class="lg:col-span-2">
                <div class="bg-white p-8 rounded-none shadow-sm border border-gray-200">
                    <h2 class="text-xl font-medium text-gray-900 mb-6 tracking-wide uppercase border-b border-gray-300 pb-3">Данные клиента</h2>
                    
                    <form id="orderForm" class="space-y-8" method="post" action="{% url 'orders:checkout' %}">
                        {% csrf_token %}

                        <!-- Имя и Фамилия в строку -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                <label for="{{ form.first_name.id_for_label }}" class="block text-gray-900 text-sm font-medium tracking-wide uppercase">{{ form.first_name.label }}</label>
                                {{ form.first_name }}
                            </div>

                            <div class="space-y-2">
                                <label for="{{ form.last_name.id_for_label }}" class="block text-gray-900 text-sm font-medium tracking-wide uppercase">{{ form.last_name.label }}</label>
                                {{ form.last_name }}
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="space-y-2">
                            <label for="{{ form.email.id_for_label }}" class="block text-gray-900 text-sm font-medium tracking-wide uppercase">{{ form.email.label }}</label>
                            {{ form.email }}
                        </div>

                        <!-- Телефон -->
                        <div class="space-y-2">
                            <label for="{{ form.phone.id_for_label }}" class="block text-gray-900 text-sm font-medium tracking-wide uppercase">{{ form.phone.label }}</label>
                            {{ form.phone }}
                        </div>

                        <!-- Адрес -->
                        <div class="space-y-2">
                            <label for="{{ form.address.id_for_label }}" class="block text-gray-900 text-sm font-medium tracking-wide uppercase">{{ form.address.label }}</label>
                            {{ form.address }}
                        </div>

                        <!-- Кнопки в форме (только очистить) -->
                        <div class="pt-4">
                            <button type="reset" class="w-full px-6 py-4 bg-white text-gray-900 font-medium tracking-wide
                                          border border-gray-400 hover:border-gray-800 transition-colors
                                          rounded-none focus:outline-none uppercase text-sm"
                            >
                                Очистить форму
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Правая колонка - Список товаров и кнопка подтверждения -->
            <div class="lg:col-span-1">
                <div class="sticky top-8">
                    <!-- Заголовок корзины -->
                    <div class="bg-white rounded-none border border-gray-200 shadow-sm mb-6">
                        <div class="p-6 border-b border-gray-300">
                            <h2 class="text-xl font-medium text-gray-900 tracking-wide uppercase">Ваш заказ</h2>
                            <p class="text-gray-600 text-sm mt-1 font-light">Товаров: <span class="font-medium">{{ cart_items|length }}</span></p>
                        </div>

                        <!-- Список товаров -->
                        <div class="p-4 space-y-4 max-h-[400px] overflow-y-auto">
                            {% for item in cart_items %}
                            <div class="flex items-start gap-4 p-3 border border-gray-200 hover:border-gray-300 transition-colors">
                                <!-- Изображение товара -->
                                <div class="w-16 h-16 flex items-center justify-center border border-gray-300 overflow-hidden bg-gray-100">
                                    {% if item.product.main_image and item.product.main_image.url %}
                                        <img src="{{ item.product.main_image.url }}"
                                             alt="{{ item.product.name }}"
                                             class="w-full h-full object-cover">
                                    {% else %}
                                        <!-- Единое изображение-заглушка для всех товаров -->
                                        <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                                            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="flex-1 min-w-0">
                                    <h3 class="font-medium text-gray-900 text-sm truncate">{{ item.product.name }}</h3>
                                    <p class="text-gray-500 text-xs mt-1">ЧПУ: {{ item.product.slug }}</p>
                                    <div class="flex justify-between items-center mt-2">
                                        <div class="flex items-center gap-2">
                                            <span class="text-gray-700 font-medium">{{ item.quantity }} ×</span>
                                            <span class="text-gray-900 font-medium">{{ item.product.price }} ₽</span>
                                        </div>
                                        <span class="text-gray-900 font-medium">{{ item.total_price }} ₽</span>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-8 text-gray-500">
                                <p>Корзина пуста</p>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Итоги -->
                        <div class="p-6 border-t border-gray-300 space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Сумма товаров:</span>
                                <span class="text-gray-900 font-medium">{{ subtotal }} ₽</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Доставка:</span>
                                <span class="text-gray-900 font-medium">0 ₽</span>
                            </div>
                            <div class="h-px bg-gray-300"></div>
                            <div class="flex justify-between text-base pt-2">
                                <span class="text-gray-900 font-medium">Итого:</span>
                                <span class="text-gray-900 font-bold text-lg">{{ total_price }} ₽</span>
                            </div>
                        </div>
                    </div>

                    <!-- Кнопка подтверждения заказа -->
                    <div class="mb-6">
                        <button
                            name="payment_provider"
                            value="stripe"
                            type="submit"
                            form="orderForm"
                            class="w-full px-6 py-4 bg-gray-900 text-white font-medium tracking-wide
                                   hover:bg-gray-800 transition-colors rounded-none border border-gray-900
                                   focus:outline-none focus:bg-gray-700 uppercase text-sm text-center
                                   {% if not cart_items %}opacity-50 cursor-not-allowed{% endif %}"
                            {% if not cart_items %}disabled{% endif %}
                        >
                            Подтвердить заказ
                        </button>
                        <p class="text-gray-500 text-xs text-center mt-2 font-light">
                            Нажимая кнопку, вы соглашаетесь с условиями обработки данных
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}